<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Super Typing Trainer</title>
<style>
body {
    font-family: Comic Sans MS, sans-serif;
    background: #f0f9ff;
    text-align: center;
    padding: 30px;
}
#levelDisplay, #scoreDisplay, #timerDisplay {
    font-size: 24px;
    margin-top: 15px;
}
#sentence {
    font-size: 28px;
    font-weight: bold;
    margin: 20px;
    min-height: 40px;
}
#inputBox {
    font-size: 24px;
    padding: 10px;
    width: 80%;
}
#result {
    font-size: 24px;
    margin-top: 15px;
}
#nextBtn, #listenBtn {
    display: none;
    padding: 12px 20px;
    font-size: 20px;
    margin-top: 15px;
    margin-right: 10px;
}
#picture {
    width: 200px;
    height: 200px;
    object-fit: cover;
    margin: 20px auto;
    border: 3px solid #ccc;
    border-radius: 10px;
    background: white;
    padding: 10px;
}
.correct { color: green; }
.incorrect { color: red; }
.badge {
    font-size: 28px;
    margin-top: 10px;
    color: orange;
}
</style>
</head>
<body>

<h1>Super Typing Trainer</h1>

<div id="levelDisplay"></div>
<div id="scoreDisplay"></div>
<div id="timerDisplay"></div>

<img id="picture" src="" alt="Picture">

<div id="sentence"></div>
<input id="inputBox" autocomplete="off" placeholder="Type here..." />

<div id="result"></div>
<button id="listenBtn">ðŸ”Š Listen</button>
<button id="nextBtn">Next</button>
<div id="badge" class="badge"></div>

<script>
// -------- SOUND EFFECTS -------- //
function playBeep(freq, duration) {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.frequency.value = freq;
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.start();
    setTimeout(() => osc.stop(), duration);
}

// -------- TEXT-TO-SPEECH -------- //
function speakText(text) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.rate = 0.9;
    utterance.pitch = 1;
    speechSynthesis.speak(utterance);
}

// -------- LEVELS -------- //
const levels = [
    // Level 1: Words
    { name: "Level 1: Words",
      sentences: [
        { text: "cat" },
        { text: "dog" },
        { text: "sun" },
        { text: "pig" },
        { text: "hat" }
      ]},
    // Level 2: Short phrases
    { name: "Level 2: Short Phrases",
      sentences: [
        { text: "the cat" },
        { text: "my dog" },
        { text: "big sun" },
        { text: "red hat" },
        { text: "pink pig" }
      ]},
    // Level 3: Simple sentences
    { name: "Level 3: Sentences",
      sentences: [
        { text: "The cat is big." },
        { text: "I see the sun." },
        { text: "My dog runs fast." }
      ]},
    // Level 4: Medium sentences
    { name: "Level 4: Sentences",
      sentences: [
        { text: "We play in the park." },
        { text: "Mom makes a cake." }
      ]},
    // Level 5: Longer sentences
    { name: "Level 5: Sentences",
      sentences: [
        { text: "I like to read books with my friends." },
        { text: "The dog jumps high over the fence." }
      ]}
];

let level = 0;
let score = 0;
let currentSentence = "";
let timer = 0;
let timerInterval;

// -------- UPDATE DISPLAYS -------- //
function updateDisplays() {
    document.getElementById("levelDisplay").textContent = levels[level].name;
    document.getElementById("scoreDisplay").textContent = "Score: " + score;
    document.getElementById("timerDisplay").textContent = "Time: " + timer + "s";
}

// -------- BADGES -------- //
function showBadge(text) {
    const badge = document.getElementById("badge");
    badge.textContent = text;
    setTimeout(()=>{badge.textContent="";}, 2000);
}

// -------- GET DYNAMIC IMAGE -------- //
function getImageURL(text) {
    const keyword = text.replace(/[^\w\s]/gi,'').split(' ').slice(0,3).join(',');
    return `https://source.unsplash.com/200x200/?${keyword}`;
}

// -------- NEW SENTENCE -------- //
function newSentence() {
    clearInterval(timerInterval);
    timer = 0;
    timerInterval = setInterval(()=>{ 
        timer++; 
        document.getElementById("timerDisplay").textContent = "Time: " + timer + "s"; 
    }, 1000);

    const data = levels[level].sentences[Math.floor(Math.random()*levels[level].sentences.length)];
    currentSentence = data.text;
    document.getElementById("sentence").textContent = currentSentence;

    // fetch dynamic image
    document.getElementById("picture").src = getImageURL(currentSentence);

    document.getElementById("inputBox").value = "";
    document.getElementById("result").textContent = "";
    document.getElementById("nextBtn").style.display = "none";
    document.getElementById("listenBtn").style.display = "inline-block";

    speakText(currentSentence);
}

// -------- CHECK TYPING WITH HIGHLIGHTING -------- //
document.getElementById("inputBox").addEventListener("input", function() {
    const typed = this.value;
    const display = typed.split("").map((c,i)=> {
        if(currentSentence[i]===c) return `<span class="correct">${c}</span>`;
        else return `<span class="incorrect">${c}</span>`;
    }).join("");
    document.getElementById("result").innerHTML = display;

    if(typed.trim() === currentSentence) {
        playBeep(900,150);
        showBadge("ðŸŽ‰ Great job!");
        score += 10;
        updateDisplays();
        document.getElementById("nextBtn").style.display="inline-block";
    } else {
        playBeep(200,40);
    }
});

// -------- NEXT BUTTON -------- //
document.getElementById("nextBtn").onclick = function() {
    if(score >= (level+1)*50 && level < levels.length-1) {
        level++;
        showBadge("ðŸŒŸ Level Up!");
    }
    updateDisplays();
    newSentence();
};

// -------- LISTEN BUTTON -------- //
document.getElementById("listenBtn").onclick = function() {
    speakText(currentSentence);
};

// -------- INIT -------- //
updateDisplays();
newSentence();
</script>
</body>
</html>
